# RabbitMQ Infrastructure (Docker Compose)

![License](https://img.shields.io/badge/license-MIT-green)
![Docker](https://img.shields.io/badge/docker-compose-blue)
![RabbitMQ](https://img.shields.io/badge/rabbitmq-3.13-orange)

---

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç **–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—É—é –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é RabbitMQ**, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–Ω-–æ–∫—Ä—É–∂–µ–Ω–∏–π.

–¶–µ–ª–∏:
- –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç –±—Ä–æ–∫–µ—Ä–∞;
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä—É—á–Ω—ã—Ö post-start —Å–∫—Ä–∏–ø—Ç–æ–≤;
- —Ö—Ä–∞–Ω–µ–Ω–∏–µ *–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö* —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (`.env`);
- –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `docker-compose` + `Makefile`.

---

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)
- [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#-–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [Makefile](#-makefile)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–û—á–∏—Å—Ç–∫–∞ –∏ —Å–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö](#-–æ—á–∏—Å—Ç–∫–∞-–∏-—Å–±—Ä–æ—Å-–¥–∞–Ω–Ω—ã—Ö)

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **RabbitMQ 3.13 + Management Plugin**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**:
  - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  - vhost'—ã
  - permissions
  - –æ—á–µ—Ä–µ–¥–∏
- –ü–∞—Ä–æ–ª–∏ **–Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**
- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `envsubst`

‚ùó –ù–∏–∫–∞–∫–∏—Ö `rabbitmqctl` –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚ùó –ù–∏–∫–∞–∫–æ–π runtime-–º–∞–≥–∏–∏ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –±—Ä–æ–∫–µ—Ä–∞

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
.
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ .env.template
‚îú‚îÄ‚îÄ data/                # volume RabbitMQ (persistent)
‚îú‚îÄ‚îÄ logs/                # –ª–æ–≥–∏ RabbitMQ
‚îî‚îÄ‚îÄ rabbitmq/
    ‚îú‚îÄ‚îÄ rabbitmq.conf
    ‚îú‚îÄ‚îÄ definitions.template.json
    ‚îî‚îÄ‚îÄ definitions.json   # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è
```

---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü–∞—Ä–æ–ª–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `.env` (–ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ –≤ git)
2. `definitions.template.json` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã `$ADMIN`, `$STREAM_GAME`, –∏ —Ç.–¥.
3. `make generate-config`:
   - –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç `.env`
   - –≤—ã–ø–æ–ª–Ω—è–µ—Ç `envsubst`
   - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `definitions.json`
4. RabbitMQ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
   - —á–∏—Ç–∞–µ—Ç `rabbitmq.conf`
   - –∑–∞–≥—Ä—É–∂–∞–µ—Ç `definitions.json`
   - —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, vhost'—ã, –æ—á–µ—Ä–µ–¥–∏

üìå –í—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏–π –∏ race-condition'–æ–≤.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
make init            # —Å–æ–∑–¥–∞—Ç—å .env –∏–∑ —à–∞–±–ª–æ–Ω–∞
nano .env            # –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
make start           # —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å RabbitMQ
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞:
- Management UI: http://localhost:15672
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: –∏–∑ `.env`

---

## üõ† Makefile

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

- `make start` ‚Äî —Å—Ç–∞—Ä—Ç –±—Ä–æ–∫–µ—Ä–∞
- `make stop` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)
- `make restart` ‚Äî —Ä–µ—Å—Ç–∞—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `make destroy` ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ docker volumes
- `make wipe` ‚Äî **–æ–ø–∞—Å–Ω–æ**: —É–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ `data/` –∏ `logs/`
- `make logs` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- `make status` ‚Äî —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- `.env` **–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è**
- –ü–∞—Ä–æ–ª–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `definitions.json` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- `definitions.json` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- Management API –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

–≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç:
- –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º—ã–µ –æ–∫–Ω–∞
- –ø—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –æ—à–∏–±–∫–∏ —Å `rabbitmqctl` –∏ Erlang cookie

---

## üß® –û—á–∏—Å—Ç–∫–∞ –∏ —Å–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –∫–æ–º–∞–Ω–¥–∞ –Ω–∏–∂–µ —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ RabbitMQ:

```bash
make wipe
```

* * *

### –ö–∞–∫ –º–æ–∂–Ω–æ –æ—Ç–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å:
* –û—Ñ–æ—Ä–º–∏—Ç—å —É–¥–æ–±–Ω—É—é –¥–ª—è –≤–∞—Å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ [Boosty.to](https://boosty.to/lliammah/ref)  
* –†–∞–∑–æ–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —á–µ—Ä–µ–∑ [DonationAlerts](https://www.donationalerts.com/r/lliammah)  